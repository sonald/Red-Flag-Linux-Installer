# 恢复安装
该文档用来描述恢复安装的基本流程和技术实现。是对DESIGN.md的补充说明。

## 约束
+ 恢复安装只用于OEM，在此条件下安装程序可以准确判断是光盘还是usb安装，并确定ISO设备的路径。
+ 假定分区表方案完全等同于SONY、LENOVO的全磁盘方案。
+ 为实现恢复安装，必须修改原安装程序，以及后期脚本。
    
    - 安装程序添加新的命令行参数支持启动恢复模式。
    - 后期脚本安装grub时，生成带rfrestore参数的引导项。
    - 传递ISO设备路径给postjob脚本。格式为`ISO_DEV=/dev/sda`。保存恢复时所使用的ISO的工作由postjob完成。

## 流程
1. 如果grub引导时带有rfrestore参数，就进入恢复模式，否则走正常安装流程。
2. 进入恢复模式，安装程序显示选择：
    a. 恢复系统
    b. 覆盖安装
3. 根据用户选择进行自动安装：
    恢复安装将格式化除第一个分区（存储恢复数据的分区）外的所有分区。
    开始安装。
    安装完成后不跑postjob脚本。
    `覆盖安装`同`恢复系统`，但是不格式化任何一个分区。
